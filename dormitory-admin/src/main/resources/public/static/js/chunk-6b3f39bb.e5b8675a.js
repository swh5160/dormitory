(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6b3f39bb"],{3785:function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app-container"},[n("avue-crud",{ref:"crud",attrs:{data:e.records,option:e.option,page:e.page,search:e.search},on:{"update:page":function(t){e.page=t},"update:search":function(t){e.search=t},"size-change":e.sizeChange,"current-change":e.currentChange,"search-change":e.searchChange,"search-reset":e.resetChange,"row-save":e.rowSave,"row-update":e.rowUpdate},scopedSlots:e._u([{key:"contentForm",fn:function(t){return[n("editor",{attrs:{"min-height":200},model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}})]}},{key:"type",fn:function(t){var r=t.row;return[0===r.type?n("el-tag",{attrs:{type:"success"}},[e._v("宿舍问题")]):n("el-tag",[e._v("学生问题")])]}},{key:"pass",fn:function(t){var r=t.row;return[r.pass?n("el-tag",{attrs:{type:"success"}},[e._v("通过")]):n("el-tag",[e._v("未通过")])]}},{key:"menu",fn:function(t){var r=t.row,a=t.index;return[n("el-button",{attrs:{type:"text",icon:"el-icon-info"},on:{click:function(t){return e.lookup(r,a)}}},[e._v("查看 ")]),e.roles.includes("ADMIN")&&!r.pass?n("el-button",{attrs:{type:"text",icon:"el-icon-edit"},on:{click:function(t){return e.handlePass(r,a)}}},[e._v("审核 ")]):e._e(),e.roles.includes("STUDENT")&&!r.pass&&r.studentId===e.user.id?n("el-button",{attrs:{type:"text",icon:"el-icon-edit"},on:{click:function(t){return e.handleUpdate(r,a)}}},[e._v("编辑 ")]):e._e(),e.roles.includes("STUDENT")&&r.studentId===e.user.id?n("el-button",{attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(t){return e.handleDel(r,a)}}},[e._v("删除 ")]):e._e(),e.roles.includes("ADMIN")?n("el-button",{attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(t){return e.handleDel(r,a)}}},[e._v("删除 ")]):e._e()]}}]),model:{value:e.form,callback:function(t){e.form=t},expression:"form"}}),n("el-dialog",{attrs:{title:"查看内容",visible:e.problemVisible,width:"80%"},on:{"update:visible":function(t){e.problemVisible=t}}},[n("el-card",{attrs:{header:e.form.title},domProps:{innerHTML:e._s(e.form.content)}}),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary"},on:{click:function(t){e.problemVisible=!1}}},[e._v("确 定")])],1)],1)],1)},a=[],o=n("c7eb"),i=n("1da1"),c=n("5530"),s=(n("ac1f"),n("841c"),n("9d9a")),l=n("095c"),u=n("2f62"),p={name:"index",components:{Editor:l["a"]},data:function(){return{problemVisible:!1,form:{},page:{total:0,layout:"total, sizes, prev, pager, next, jumper"},records:[],search:{title:""},option:{editBtn:!1,delBtn:!1,align:"center",searchMenuSpan:8,index:!0,indexLabel:"序号",column:[{label:"楼栋号",prop:"bno",search:!0,display:!1},{label:"房间号",prop:"rno",search:!0,display:!1},{label:"学生姓名",prop:"studentName",search:!0,display:!1},{label:"类型",prop:"type",search:!0,type:"select",rules:[{required:!0,message:"请选择类型",trigger:"blur"}],dicData:[{label:"宿舍问题",value:0},{label:"学生问题",value:1}]},{label:"标题",prop:"title",search:!0,width:200,rules:[{required:!0,message:"请输入标题",trigger:"blur"}]},{label:"内容",formslot:!0,prop:"content",hide:!0,rules:[{required:!0,message:"请输入内容",trigger:"blur"}]},{label:"是否通过",prop:"pass",search:!0,display:!1,type:"select",dicData:[{label:"通过",value:1},{label:"未通过",value:0}],width:100},{label:"回复内容",prop:"reply",display:!1,width:200},{label:"创建时间",prop:"gmtCreate",display:!1,width:200},{label:"修改时间",prop:"gmtModified",display:!1,width:200}]},auditOption:{submitText:"审核",span:24,column:[{label:"是否通过",prop:"pass",type:"radio",dicData:[{label:"通过",value:!0},{label:"未通过",value:!1}],rules:[{required:!0,trigger:"blur"}]},{label:"答复内容",prop:"reply",type:"textarea",rules:[{required:!0,message:"请输入答复内容",trigger:"blur"}]}]},content:void 0}},computed:Object(c["a"])({},Object(u["b"])(["roles","user"])),created:function(){console.log(this.roles),this.getList()},methods:{lookup:function(e,t){this.problemVisible=!0,this.form=e},getList:function(){var e=this;this.search.current=this.page.currentPage,this.search.size=this.page.pageSize,Object(s["d"])(this.search).then((function(t){e.records=t.data.records,e.page.total=t.data.total}))},handlePass:function(e,t){var n=this;this.$DialogForm.show({title:"审核",width:"50%",option:this.auditOption,callback:function(){var t=Object(i["a"])(Object(o["a"])().mark((function t(r){return Object(o["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log(r),t.next=3,Object(s["a"])({id:e.id,pass:r.data.pass,reply:r.data.reply});case 3:n.msgNoticeSuccess("审核成功"),n.getList(),r.done(),r.close();case 7:case"end":return t.stop()}}),t)})));function r(e){return t.apply(this,arguments)}return r}()})},rowSave:function(e,t,n){var r=this;Object(s["f"])(e).then((function(e){r.msgNoticeSuccess("新增成功"),r.getList()})),t()},handleUpdate:function(e,t){this.$refs.crud.rowEdit(e,t)},rowUpdate:function(e,t,n,r){var a=this;Object(s["f"])(e).then((function(e){a.msgNoticeSuccess("修改成功"),a.getList()})),n()},handleDel:function(e,t){var n=this;this.$confirm("此操作将永久删除该信息, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(s["b"])(e.id).then((function(e){n.msgNoticeSuccess("删除成功"),n.getList()}))})).catch((function(){}))},resetChange:function(e){this.search.username="",this.getList()},searchChange:function(e,t){this.search.username=e.username,this.getList(),t()},sizeChange:function(e){this.page.currentPage=1,this.page.pageSize=e,this.getList()},currentChange:function(e){this.page.currentPage=e,this.getList()}}},d=p,h=n("2877"),f=Object(h["a"])(d,r,a,!1,null,"3b9d089e",null);t["default"]=f.exports},"9d9a":function(e,t,n){"use strict";n.d(t,"d",(function(){return i})),n.d(t,"f",(function(){return c})),n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return l})),n.d(t,"c",(function(){return u})),n.d(t,"e",(function(){return p}));var r=n("b775"),a=n("751a"),o="/api/problem";function i(e){return Object(r["a"])({url:"".concat(o,"/get/page"),method:a["a"].GET,params:e})}function c(e){return Object(r["a"])({url:"".concat(o),method:a["a"].POST,data:e})}function s(e){return Object(r["a"])({url:"".concat(o,"/").concat(e),method:a["a"].DELETE})}function l(e){return Object(r["a"])({url:"".concat(o,"/audit"),method:a["a"].PUT,data:e})}function u(e){return Object(r["a"])({url:"".concat(o,"/get/my/page"),method:a["a"].GET,params:e})}function p(e){return Object(r["a"])({url:"".concat(o,"/get/recent/").concat(e),method:a["a"].GET})}}}]);